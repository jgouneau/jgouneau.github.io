---
# Documentation: https://hugoblox.com/docs/managing-content/

title: "Semi Supervised YOLOv2"
summary: "2 months internship on the implementation of YOLOv2 and the test on this model of a semi-supervised learning method for object classification."
authors: [admin, Axel Carlier]
tags: [research, internship]
categories: [research, internship]
date: 2021-08-02T22:37:13+01:00

# Optional external URL for project (replaces project detail page).
external_link: ""

# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.
image:
  caption: ""
  focal_point: ""
  preview_only: false

# Custom links (optional).
#   Uncomment and edit lines below to show custom links.
links:
- name: Colab Notebook
  url: https://drive.google.com/file/d/1eZ0xv8UOvgR76BYIBrzd3xzVTPF6X2YX/view?usp=sharing

url_code: "https://github.com/jgouneau/YOLOv2"
url_pdf: ""
url_slides: ""
url_video: ""

# Slides (optional).
#   Associate this project with Markdown slides.
#   Simply enter your slide deck's filename without extension.
#   E.g. `slides = "example-slides"` references `content/slides/example-slides.md`.
#   Otherwise, set `slides = ""`.
slides: ""
---

## Summary
This project was carried out during an internship with IRIT, Toulouse, with Axel Carlier as tutor. 

{{% callout warning %}}
The code supplied is only an untested python scripts version of the Google Colab Notebook.
{{% /callout %}}

## YOLOv2
The fisrt part of this project was having a functional and trainable model for image detection based on YOLOv2 [^1]. This was done by extracting and adapting code snippets from an existing implementation to a Jupyter Notebook.

### Results

I obtained the following quantitative results :

|                | YOLOv2 (30 epochs) |
| -------------- | ------------------ | 
| training mAP   | 0.73               | 
| validation mAP | 0.65               | 

And qualitative results :
![2 zebras well detected](project/yolov2/yolo_qualitative_1.png "")
![3 elephants well detected](project/yolov2/yolo_qualitative_2.png "")
![only one rhino detected on 2](project/yolov2/yolo_qualitative_3.png "")

## Semi-supervised Learning for Image Detection

![The teacher-student semi-supervised training process](project/yolov2/semi-supervised_training.png "The teacher-student semi-supervised training process")

The second part of this project was the implementation of a semi-supervised training for object detection [^2] on this functional model.
This affected the loss of the model ; initially YOLOv2 has the following loss :

{{< math >}}
$$
\begin{align}
l_{\textrm{yolo}} &= \lambda_{\textrm{coord}} \sum_{i=0}^{S^2} \sum_{j=0}^B \mathbb{1}_{ij}^{\textrm{obj}} \left[ \left( x_{ij} - \hat x_{ij} \right)^2 + \left( y_{ij} - \hat y_{ij} \right)^2 \right] \\
&+ \lambda_{\textrm{coord}} \sum_{i=0}^{S^2} \sum_{j=0}^B \mathbb{1}_{ij}^{\textrm{obj}} \left[ \left( \sqrt w_{ij} - \sqrt{\hat w_{ij}} \right)^2 + \left( \sqrt h_{ij} - \sqrt{\hat h_{ij}} \right)^2 \right] \\
&+ \lambda_{\textrm{obj}} \sum_{i=0}^{S^2} \sum_{j=0}^B \mathbb{1}_{ij}^{\textrm{obj}} \left( C_{ij} - \hat C_{ij} \right)^2 \\
&+ \lambda_{\textrm{noobj}} \sum_{i=0}^{S^2} \sum_{j=0}^B \mathbb{1}_{ij}^{\textrm{noobj}} \left( C_{ij} - \hat C_{ij} \right)^2 \\
&+ \lambda_{\textrm{class}} \sum_{i=0}^{S^2} \sum_{j=0}^B \mathbb{1}_{ij}^{\textrm{obj}} \sum_{c \in \textrm{classes}} \left( p_{ij}(c) - \hat p_{ij}(c) \right)^2 \\
\end{align}
$$
{{< /math >}}
where {{< math >}}$ \hspace{1em} \mathbb{1}_{ij}^{\textrm{noobj}} = 1 - \mathbb{1}_{ij}^{\textrm{obj}} \hspace{1em} \forall (i, j) \in S^2 \times B ${{< /math >}}

But to in order take into account the pseudo-labels generated by the teacher, I modified the loss as follows :

{{< math >}}
$$
\begin{align}
l_{\textrm{yolo_ssl}} &= \sum_{i=0}^{S^2} \sum_{j=0}^B \left( \mathbb{1}_{ij}^s \lambda_s + \mathbb{1}_{ij}^u \lambda_u \right) l_{ij} \\
l_{ij} = &\lambda_{\textrm{coord}}  \mathbb{1}_{ij}^{\textrm{obj}} \left[ \left( x_{ij} - \hat x_{ij} \right)^2 + \left( y_{ij} - \hat y_{ij} \right)^2 \right] \\
+ &\lambda_{\textrm{coord}} \mathbb{1}_{ij}^{\textrm{obj}} \left[ \left( \sqrt w_{ij} - \sqrt{\hat w_{ij}} \right)^2 + \left( \sqrt h_{ij} - \sqrt{\hat h_{ij}} \right)^2 \right] \\
+ &\left[ \lambda_{\textrm{obj}} \mathbb{1}_{ij}^{\textrm{obj}} (1 - \mathbb{1}_{ij}^{\textrm{noobj}}) + \lambda_{\textrm{noobj}} \mathbb{1}_{ij}^{\textrm{noobj}} \right] \left( C_{ij} - \hat C_{ij} \right)^2 \\
+ &\lambda_{\textrm{class}} \mathbb{1}_{ij}^{\textrm{obj}} \sum_{c \in \textrm{classes}} \left( p_{ij}(c) - \hat p_{ij}(c) \right)^2 \\
\end{align}
$$
{{< /math >}}
where {{< math >}}$ \hspace{1em} \mathbb{1}_{ij}^{\textrm{obj}} = 1 \hspace{1em} ${{< /math >}} for all labeled and unlabeled boxes that contain an object, and {{< math >}}$ \hspace{1em} \mathbb{1}_{ij}^{\textrm{noobj}} = 1 \hspace{1em} ${{< /math >}} for all labeled and unlabeled boxes that does not contain an object and all unlabeled boxes for which the teacher has a confidence under a certain threshold.

### Results
I obtained the following results :

|                | Teacher (60 epochs) | Student (30 epochs) | Student² (30 epochs) | 
| -------------- | ------------------- | ------------------- | -------------------- | 
| training mAP   | 0.79                | 0.82                | 0.81                 | 
| validation mAP | 0.67                | 0.70                | 0.68                 | 

Showing proof of concept that the student performs better than the teacher, but also that using the student to train a new student (`Student²` here) does not seem to make any improvement.


[^1]: Joseph Redmon, Ali Farhadi, "YOLO9000: Better, Faster, Stronger," 2016.
[^2]: Kihyuk Sohn et al, "A Simple Semi-Supervised Learning Framework for Object Detection," 2020.